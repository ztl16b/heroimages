{% extends "base.html" %}

{% block title %}Upload Images{% endblock %}

{% block extra_css %}
.upload-area {
    border: 2px dashed #ccc;
    border-radius: 8px;
    padding: 2rem;
    text-align: center;
    margin-bottom: 2rem;
    cursor: pointer;
}
.upload-area:hover {
    border-color: #0d6efd;
}
.file-preview {
    margin-top: 1rem;
}
.file-item {
    display: flex;
    align-items: center;
    padding: 0.5rem;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    margin-bottom: 0.5rem;
}
.file-item .remove-file {
    margin-left: auto;
    color: #dc3545;
    cursor: pointer;
}
.progress {
    height: 0.5rem;
    margin-top: 0.5rem;
}
{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mt-5 mb-4">Upload Images</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="post" enctype="multipart/form-data" id="uploadForm">
        <div class="upload-area" id="dropZone">
            <input type="file" name="files" id="fileInput" multiple accept="image/*" style="display: none;">
            <div class="mb-3">
                <i class="bi bi-cloud-upload" style="font-size: 3rem;"></i>
                <h4>Drag & Drop files here</h4>
                <p class="text-muted">or</p>
                <button type="button" class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                    Select Files
                </button>
            </div>
            <p class="text-muted">Supported formats: JPG, PNG, GIF</p>
        </div>

        <div id="filePreview" class="file-preview"></div>

        <div class="d-grid gap-2">
            <button type="submit" class="btn btn-primary" id="uploadButton" disabled>
                Upload Files
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // File upload handling code
    document.addEventListener('DOMContentLoaded', function() {
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const filePreview = document.getElementById('filePreview');
        const uploadButton = document.getElementById('uploadButton');
        let files = [];

        // Prevent default drag behaviors
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false);
        });

        // Highlight drop zone when item is dragged over it
        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, unhighlight, false);
        });

        // Handle dropped files
        dropZone.addEventListener('drop', handleDrop, false);
        
        // Handle file input change
        fileInput.addEventListener('change', handleFiles, false);

        function preventDefaults (e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function highlight(e) {
            dropZone.classList.add('bg-light');
        }

        function unhighlight(e) {
            dropZone.classList.remove('bg-light');
        }

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const newFiles = dt.files;
            handleFiles({ target: { files: newFiles } });
        }

        function handleFiles(e) {
            files = [...e.target.files];
            updateFilePreview();
        }

        function updateFilePreview() {
            filePreview.innerHTML = '';
            
            if (files.length === 0) {
                uploadButton.disabled = true;
                return;
            }
            
            uploadButton.disabled = false;
            
            files.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                
                const fileName = document.createElement('span');
                fileName.textContent = file.name;
                
                const removeButton = document.createElement('span');
                removeButton.className = 'remove-file';
                removeButton.innerHTML = '&times;';
                removeButton.onclick = function() {
                    files.splice(index, 1);
                    updateFilePreview();
                };
                
                fileItem.appendChild(fileName);
                fileItem.appendChild(removeButton);
                filePreview.appendChild(fileItem);
            });
        }
    });
</script>
{% endblock %} 